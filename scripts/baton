#!/bin/sh
set -eu

if command -v readlink >/dev/null 2>&1 && readlink -f / >/dev/null 2>&1; then
  BATON_PATH=$(readlink -f "$0" 2>/dev/null || echo "$0")
else
  BATON_PATH="$0"
fi

REPO_ROOT=$(CDPATH= cd -- "$(dirname -- "$BATON_PATH")/.." && pwd)
ENV_SETUP="$REPO_ROOT/env-setup.sh"
[ -f "$ENV_SETUP" ] || { echo "ERROR: env-setup.sh not found at $ENV_SETUP" >&2; exit 1; }
. "$ENV_SETUP"

CMD="${1:-}"
shift || true

case "$CMD" in
  deploy|ssl-issue|stand-down)
    exec "$SCRIPT_DIR/cmd/${CMD}.sh" "$@"
    ;;
  help|--help|-h|"")
    echo "Usage: baton <deploy|ssl-issue|stand-down> <project>"
    exit 0
    ;;
  *)
    echo "Unknown command: $CMD"
    echo "Use 'baton help'"
    exit 1
    ;;
esac
